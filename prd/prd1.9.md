# 产品需求文档：知识库管理与手动同步 - V1.9

## 1. 綜述 (Overview)
### 1.1 项目背景与核心问题
随着V1.6和V1.8版本实现了高效的“审核工作台”，系统能够持续产出审核通过的正式知识。为了形成管理闭环，并对最终同步到AICO平台的数据有完全的掌控力，V1.9版本的核心目标是开发“正式知识库管理”页面。该页面将为管理员提供查询、编辑和状态管理（启用/禁用）的能力。此外，为应对紧急更新需求，本版本还将引入“手动同步”功能，允许管理员按需触发知识库到AICO平台的即时同步。

### 1.2 核心业务流程 / 用户旅程地图
V1.9版本聚焦于知识入库后的管理和发布阶段，其核心用户旅程如下：
1.  **阶段一：查询与定位** - 管理员进入“知识库管理”页面，通过状态页签和关键词搜索，快速找到需要管理的知识条目。
2.  **阶段二：内容与状态维护** - 管理员通过“编辑”功能更新问答文本，或通过“禁用”/“启用”按钮管理知识的生命周期。
3.  **阶段三：手动发布** - 当有紧急更新时，管理员点击【立即同步至知识库】按钮，将当前所有“已生效”的知识，立即推送到AICO平台。

## 2. 用户故事详述 (User Stories)

### 阶段一：知识库管理与发布

---

#### **US-1.9.1: 作为一名管理员，我希望能方便地管理所有已审核通过的知识，以便进行内容更新和状态维护。**
*   **价值陈述 (Value Statement)**:
    *   **作为** 一名管理员
    *   **我希望** 能在一个统一的界面上，对所有正式知识进行搜索、编辑、禁用和重新启用
    *   **以便于** 应对业务变化，修正错误，管理知识的生命周期，确保最终同步到AICO的知识库是准确和最新的。
*   **业务规则与逻辑 (Business Logic)**:
    1.  **数据隔离**: 页面加载的所有数据，都必须严格遵循当前登录用户的场景隔离（水务/公交）。
    2.  **默认视图**: 进入页面时，默认显示“已生效”状态的知识列表。
    3.  **筛选逻辑**: 点击状态页签（Tabs）或使用关键词搜索时，前端调用`GET /api/v1.4.1/knowledge-items`并附带对应的`status`或`keyword`参数。
    4.  **编辑逻辑**: 点击【编辑】按钮，弹出模态框。保存时，调用`PUT /api/v1.4.1/knowledge-items/{id}`，请求体中包含修改后的`question`和`answer`。
    5.  **状态变更逻辑**: 点击【禁用】/【启用】，调用`PUT /api/v1.4.1/knowledge-items/{id}`，请求体为`{"status": "disabled"}`或`{"status": "active"}`。
*   **验收标准 (Acceptance Criteria)**:
    *   **场景1: 成功禁用一条知识**
        *   **GIVEN** 我在“已生效”列表中
        *   **WHEN** 我点击某行的【禁用】按钮并确认
        *   **THEN** 该行应从“已生效”列表中消失，并出现在“已禁用”列表中。
    *   **场景2: 成功编辑一条知识**
        *   **GIVEN** 我在编辑模态框中修改了答案
        *   **WHEN** 我点击【保存】
        *   **THEN** 模态框关闭，列表中的对应条目应显示更新后的内容。

---

#### **US-1.9.2: 作为一名管理员，我希望能手动触发知识库的同步，以便将紧急更新立即发布到AICO平台。**
*   **价值陈述 (Value Statement)**:
    *   **作为** 一名管理员
    *   **我希望** 在知识库管理页面有一个“立即同步”按钮
    *   **以便于** 当有重要的知识更新时，我能绕过每日的自动同步计划，立即将其发布生效。
*   **业务规则与逻辑 (Business Logic)**:
    1.  **按钮位置与名称**: 在“知识库管理”页面的醒目位置（如Tabs右侧）放置一个名为【**立即同步至知识库**】的按钮。
    2.  **交互流程**:
        *   用户点击该按钮，系统弹出二次确认框：“您确定要将当前所有‘已生效’的知识同步到知识库吗？”。
        *   用户确认后，前端调用`POST /api/v1.3/scenarios/{scenarioId}/trigger-sync` API。
        *   **异步反馈**: 由于后台同步是异步任务，前端在API调用成功后，应立即给出反馈，如按钮变为“同步中...”并禁用，同时弹出全局提示“同步任务已开始，请稍后确认结果”。
*   **验收标准 (Acceptance Criteria)**:
    *   **场景1: 成功触发手动同步**
        *   **GIVEN** 我在知识库管理页面
        *   **WHEN** 我点击【立即同步至知识库】按钮并确认
        *   **THEN** 前端应成功调用后台的`trigger-sync` API，并向我展示“同步任务已开始”的提示。

---
*   **技术实现概要 (Technical Implementation Brief)**:
    *   **前端技术栈**: React + Ant Design
    *   **视觉参考**: 本页面的最终视觉效果应以用户提供的UI设计图为准。
    *   **页面布局线框图 (ASCII Wireframe)**:
        ```text
        +------------------------------------------------------------------------------------------+
        | FAQ 智能挖掘系统      当前知识库: [ 水务知识库 ]                     [用户: 水务管理员 v] |
        +==========================================================================================+
        | 知识库管理                                                                               |
        |------------------------------------------------------------------------------------------|
        |                                                                                          |
        |  [ 按问题或答案关键词搜索...      ]  [ 搜索 ]          [ 🔄 立即同步至知识库 ]              |
        |                                                                                          |
        +------------------------------------------------------------------------------------------+
        |                                                                                          |
        |   [ 已生效 (256) ]  [ 已禁用 (12) ]                                                      |
        |  +---------------------------------------------------------------------------------------+ |
        |  |                                                                                       | |
        |  | +----------------------+--------------------------+------------+-------------------+ | |
        |  | | 问题                 | 答案摘要                 | 最后更新   | 操作              | | |
        |  | +----------------------+--------------------------+------------+-------------------+ | |
        |  | | 如何查询个人用水户号？ | 提供户主姓名与准确用水地址后... | 2024-10-28 | [ 编辑 ] [ 禁用 ] | | |
        |  | +----------------------+--------------------------+------------+-------------------+ | |
        |  | | ...                  | ...                      | ...        | ...               | | |
        |  | +----------------------+--------------------------+------------+-------------------+ | |
        |  |                                                                                       | |
        |  +---------------------------------------------------------------------------------------+ |
        |                                                                                          |
        +------------------------------------------------------------------------------------------+
        ```
    *   **API 依赖 (后台)**:
        *   **知识管理**:
            *   `GET /api/v.all/knowledge-items` (版本号待后端统一，沿用之前V1.4.1定义)
            *   `PUT /api/v.all/knowledge-items/{id}`
        *   **手动同步**:
            *   `POST /api/v.all/scenarios/{scenarioId}/trigger-sync` (版本号待后端统一，沿用之前V1.3定义)

*   **约束与边界 (Constraints & Boundaries)**:
    *   本页面不提供“物理删除”功能，废弃知识的唯一方式是“禁用”。
    *   手动同步按钮触发的后台任务，应与每日定时任务共享同一套“智能同步”（有变化才同步）逻辑。