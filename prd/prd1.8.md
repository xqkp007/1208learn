# 产品需求文档：批量审核功能 - V1.8

## 1. 綜述 (Overview)
### 1.1 项目背景与核心问题
V1.6版本的“内联展开式审核”有效提升了单条FAQ的审核效率。然而，随着AI模型准确率的提升，审核员会面临大量无需修改、可直接采纳的优质FAQ。在此场景下，逐条点击“采纳”成为新的效率瓶颈。V1.8版本的核心目标是引入“批量审核”功能，允许审核员一次性选择并处理多条待审核FAQ，从而实现审核效率的规模化提升，将审核员从重复性的点击操作中解放出来。

### 1.2 核心业务流程 / 用户旅程地图
V1.8版本在V1.6的“审核工作台”基础上，优化了核心审核流程：
1.  **阶段一：选择项目** - 审核员在审核列表中，通过新增的复选框，勾选多个他/她希望批量处理的FAQ条目。
2.  **阶段二：触发批量操作** - 一个上下文操作栏在用户勾选后出现。用户在该操作栏上点击【批量采纳】或【批量废弃】按钮。
3.  **阶段三：确认与执行** - 系统弹出安全确认框。用户确认后，前端将所有选中项的ID或数据打包，通过一个API请求发送给后端。
4.  **阶段四：完成反馈** - 后端在一个事务中处理所有项目。处理成功后，前端给出成功的全局提示，并将所有已处理的条目从列表中移除。

## 2. 用户故事详述 (User Stories)

### 阶段一：批量审核

---

#### **US-1.8: 作为一名审核员，我希望能一次性选中并处理多条待审核FAQ，以便能极大地提升处理大量高质量建议时的效率。**
*   **价值陈述 (Value Statement)**:
    *   **作为** 一名审核员
    *   **我希望** 能通过复选框选择多条待审核FAQ，并使用批量按钮一键完成采纳或废弃
    *   **以便于** 当面临大量明显无误的AI建议时，我能以最少的操作步骤完成审核任务，专注于处理需要斟酌的复杂案例。
*   **业务规则与逻辑 (Business Logic)**:
    1.  **界面变更**:
        *   在“审核工作台”的表格第一列，增加**复选框**列。表头对应位置为“全选/反选”复选框。
        *   引入一个**上下文批量操作栏**。该操作栏默认隐藏。当用户勾选至少一项后，该操作栏出现，显示“已选择 N 项”及【批量采纳】、【批量废弃】按钮。当所有项都被取消勾选时，该操作栏再次隐藏。
    2.  **批量采纳流程**:
        *   用户勾选多项后，点击【批量采纳】。
        *   系统必须弹出一个模态框进行二次确认，如：“您确定要采纳这 N 条FAQ吗？”。
        *   用户确认后，前端调用`POST /api/v1.8/knowledge-items/bulk-create` API。
    3.  **批量废弃流程**:
        *   用户勾选多项后，点击【批量废弃】。
        *   系统进行二次确认。
        *   用户确认后，前端调用`POST /api/v1.8/pending-faqs/bulk-discard` API。
    4.  **后端处理**: 后端在处理批量请求时，必须将所有数据库操作包裹在一个**事务（Transaction）**中，确保批量任务的原子性（要么全部成功，要么全部失败）。
*   **验收标准 (Acceptance Criteria)**:
    *   **场景1: 成功批量采纳**
        *   **GIVEN** 我在审核列表勾选了3条FAQ
        *   **WHEN** 我点击批量操作栏的【批量采纳】按钮，并在弹出的确认框中点击“确定”
        *   **THEN** 前端应只发起一次API调用，页面应提示“3条FAQ采纳成功”，并且这3条记录应从列表中消失。
    *   **场景2: 操作栏的动态显隐**
        *   **GIVEN** 批量操作栏当前是隐藏的
        *   **WHEN** 我勾选列表中的任意一项
        *   **THEN** 批量操作栏应立即出现。当我取消所有勾选项后，该操作栏应再次隐藏。

---
*   **技术实现概要 (Technical Implementation Brief)**:
    *   **前端**:
        *   **技术栈**: React + Ant Design
        *   **组件改造**: `Table`组件需启用`rowSelection`属性来支持复选框功能。需开发一个新的组件用于展示上下文批量操作栏。使用`Modal.confirm`来实现二次确认对话框。
    *   **后端**:
        *   需要新增两个专门处理批量操作的API Endpoint。
    *   **页面布局线框图 (ASCII Wireframe)**:
        ```text
        +--------------------------------------------------------------------------------------------------+
        | FAQ 智能挖掘系统      当前知识库: [ 水务知识库 ]                     [用户: 水务审核员 v] |
        +==================================================================================================+
        | 审核工作台                                                                                       |
        |--------------------------------------------------------------------------------------------------|
        |                                                                                                  |
        |  +--------------------------------------------------------------------------------------------+  |
        |  |  已选择 3 项          [ 批量采纳 ]  [ 批量废弃 ]                                          |  |
        |  +--------------------------------------------------------------------------------------------+  |
        |                                                                                                  |
        | +----+----------------------------------+--------------------------------+-------------------------+ |
        | | [v] | 问题摘要                       | 答案摘要                       | 操作 (单条)             | |
        | +----+----------------------------------+--------------------------------+-------------------------+ |
        | | [v] | 如何查询上个月的水费账单？       | 您可以在APP的“历史账单”中...   | [✔采纳] [展开] [✖废弃] | |
        | | [ ] | 我家水管漏水了，应该联系哪个部门？ | 您可以拨打24小时报修热线...  | [✔采纳] [展开] [✖废弃] | |
        | | [v] | 如何办理居民用水的过户手续？     | 办理过户需要携带房产证和...    | [✔采纳] [展开] [✖废弃] | |
        | | [v] | APP上怎么绑定新的用户编号？      | 在“我的账户”页面，点击“添...   | [✔采纳] [展开] [✖废弃] | |
        | +----+----------------------------------+--------------------------------+-------------------------+ |
        ```
*   **数据模型 / 接口契约 (Data Contracts & APIs)**:

    *   **API Endpoint 1: 批量采纳FAQ**
        *   **`POST /api/v1.8/knowledge-items/bulk-create`**
        *   **请求体**:
            ```json
            {
              "items": [
                { "pendingFaqId": 101, "scenarioId": 1, "question": "Q1...", "answer": "A1..." },
                { "pendingFaqId": 105, "scenarioId": 1, "question": "Q5...", "answer": "A5..." }
              ]
            }
            ```
        *   **成功响应 (201 Created)**: `{"createdCount": 2}`

    *   **API Endpoint 2: 批量废弃FAQ**
        *   **`POST /api/v1.8/pending-faqs/bulk-discard`**
        *   **请求体**:
            ```json
            {
              "pendingFaqIds": [102, 103, 107]
            }
            ```
        *   **成功响应 (200 OK)**: `{"discardedCount": 3}`

*   **约束与边界 (Constraints & Boundaries)**:
    *   为防止请求体过大或处理超时，单次批量操作的上限建议设置为100条。
*   **非功能性需求 (Non-Functional)**:
    *   **UI/UX**: 上下文操作栏的出现与消失，以及列表项的移除，都应有平滑的动画过渡效果。